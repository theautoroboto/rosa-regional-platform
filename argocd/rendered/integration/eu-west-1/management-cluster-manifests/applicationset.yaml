# GENERATED FILE - DO NOT EDIT MANUALLY
#
# This file is automatically generated by the render script.
# To make changes:
# - Edit argocd/config.yaml for config_revision references
# - Then run: argocd/scripts/render.py
#
# Cluster Type: management-cluster
# Shard: eu-west-1 (integration)
# Config Revision: metadata.annotations.git_revision
# Generated: render.py
#

apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: root-applicationset
  namespace: argocd
spec:
  goTemplate: true
  generators:
  - matrix:
      generators:
      - clusters:
          selector:
            matchLabels:
              argocd.argoproj.io/secret-type: cluster
      - git:
          directories:
          - path: argocd/config/{{ .metadata.labels.cluster_type }}/*
          - path: argocd/config/shared/*
          repoURL: '{{ .metadata.annotations.git_repo }}'
          revision: '{{ .metadata.annotations.git_revision }}'
  template:
    metadata:
      name: '{{ .path.basename }}'
      labels:
        cluster_type: '{{ .metadata.labels.cluster_type }}'
        environment: '{{ .metadata.labels.environment }}'
        region: '{{ .metadata.labels.region }}'
    spec:
      project: default
      destination:
        namespace: '{{ .path.basename }}'
        server: '{{ .server }}'
      syncPolicy:
        automated:
          prune: true
          selfHeal: true
        syncOptions:
        - ServerSideApply=true
        - CreateNamespace=true
      sources:
      - helm:
          valueFiles:
          - values.yaml
          - $values/argocd/rendered/{{ .metadata.labels.environment }}/{{ .metadata.labels.region }}/{{ .metadata.labels.cluster_type }}-values.yaml
          valuesObject:
            global:
              cluster_type: '{{ .metadata.labels.cluster_type }}'
              environment: '{{ .metadata.labels.environment }}'
              region: '{{ .metadata.labels.region }}'
            frontendApi:
              targetGroup:
                arn: '{{ .metadata.annotations.api_target_group_arn }}'
              app:
                args:
                  allowedAccounts: '{{ .metadata.annotations.api_allowed_accounts }}'
        path: '{{ .path.path }}'
        repoURL: '{{ .metadata.annotations.git_repo }}'
        targetRevision: '{{ .metadata.annotations.git_revision }}'
      - repoURL: '{{ .metadata.annotations.git_repo | replace "github.com" "github.com:443" }}'
        targetRevision: '{{ .metadata.annotations.git_revision }}'
        ref: values

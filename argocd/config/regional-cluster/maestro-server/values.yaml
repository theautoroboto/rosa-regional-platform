# Maestro Server Helm Chart Values (AWS Adaptation)
# Adapted from: https://github.com/Azure/ARO-HCP/tree/main/maestro/server/deploy

maestroServer:
  # Container image configuration
  image:
    registry: "quay.io"
    repository: "redhat-user-workloads/maestro-rhtap-tenant/maestro/maestro"
    tag: "latest"
    # digest: "sha256:..." # Use digest instead of tag for production
    pullPolicy: IfNotPresent
  # Deployment configuration
  deployment:
    replicas: 2
    zoneCount: 3 # Number of availability zones
    requests:
      cpu: "200m"
      memory: "512Mi"
    limits:
      cpu: "1000m"
      memory: "1Gi"
  # Maestro server configuration
  maestro:
    serviceAccount: "maestro-server"
    httpBindPort: 8080
    grpcBindPort: 8090
    healthCheckBindPort: 8083
    httpReadTimeout: 300
    httpWriteTimeout: 600
    labelMetricsInclusionDuration: "168h" # 7 days
    glog_v: 10 # Verbose logging level
  # Database configuration (RDS)
  database:
    # RDS connection (credentials from ExternalSecret)
    sslMode: "require"
    maxOpenConnections: 50
    debug: false
    # Note: AWS RDS uses standard password auth, not Azure Entra
    usePasswordAuth: true
  # MQTT Broker configuration (AWS IoT Core)
  broker:
    # Endpoint and credentials from ASCP CSI driver
    type: "mqtt"
    configFile: "/config/config.yaml"
    topicPrefix: "maestro/consumers"
  # AWS Pod Identity configuration
  aws:
    podIdentity:
      enabled: true
      roleArn: ""  # Populated from Terraform output via values-override.yaml
  # External Secrets configuration
  externalSecrets:
    # Secret names from Terraform outputs (populated via values-override.yaml)
    mqttCertSecretName: ""  # Will be: <cluster-name>/maestro/server-mqtt-cert
    dbCredentialsSecretName: ""  # Will be: <cluster-name>/maestro/db-credentials
  # Tracing configuration
  tracing:
    enabled: false
    address: ""
    exporter: "none"
  # Metrics configuration
  metrics:
    enabled: true
    serviceMonitor:
      enabled: false # Enable when Prometheus Operator is deployed
  # Service configuration
  service:
    http:
      type: ClusterIP
      port: 8080
    grpc:
      type: ClusterIP
      port: 8090
    health:
      type: ClusterIP
      port: 8083
    metrics:
      type: ClusterIP
      port: 8080
  # Network policy
  networkPolicy:
    enabled: false

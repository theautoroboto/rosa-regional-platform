# GENERATED FILE - DO NOT EDIT MANUALLY
#
# This file is automatically generated by the render script.
# To make changes:
# - Edit config.yaml for config_revision references
# - Then run: scripts/render.py
#
# Cluster Type: regional-cluster
# Region Deployment: e2e (e2e)
# Config Revision: metadata.annotations.git_revision
# Generated: render.py
#

apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: root-applicationset
  namespace: argocd
spec:
  goTemplate: true
  generators:
  - matrix:
      generators:
      - clusters:
          selector:
            matchLabels:
              argocd.argoproj.io/secret-type: cluster
      - git:
          directories:
          - path: argocd/config/{{ .metadata.labels.cluster_type }}/*
          - path: argocd/config/shared/*
          repoURL: '{{ .metadata.annotations.git_repo }}'
          revision: '{{ .metadata.annotations.git_revision }}'
  template:
    metadata:
      name: '{{ .path.basename }}'
      labels:
        cluster_type: '{{ .metadata.labels.cluster_type }}'
        environment: '{{ .metadata.labels.environment }}'
        region_alias: '{{ .metadata.labels.region_alias }}'
        aws_region: '{{ .metadata.labels.aws_region }}'
    spec:
      project: default
      destination:
        namespace: '{{ .path.basename }}'
        server: '{{ .server }}'
      syncPolicy:
        automated:
          prune: true
          selfHeal: true
        syncOptions:
        - ServerSideApply=true
        - CreateNamespace=true
      sources:
      - helm:
          valueFiles:
          - values.yaml
          - $values/deploy/{{ .metadata.labels.environment }}/{{ .metadata.labels.region_alias }}/argocd/{{ .metadata.labels.cluster_type }}-values.yaml
          valuesObject:
            global:
              cluster_type: '{{ .metadata.labels.cluster_type }}'
              environment: '{{ .metadata.labels.environment }}'
              aws_region: '{{ .metadata.labels.aws_region }}'
            platformApi:
              targetGroup:
                arn: '{{ .metadata.annotations.api_target_group_arn }}'
              app:
                args:
                  dynamodbRegion: '{{ .metadata.annotations.dynamodb_region }}'
                  dynamodbPrefix: '{{ .metadata.annotations.dynamodb_prefix }}'
            hyperfleetApi:
              aws:
                region: '{{ .metadata.labels.aws_region }}'
            hyperfleetSentinel:
              aws:
                region: '{{ .metadata.labels.aws_region }}'
            hyperfleetAdapter:
              aws:
                region: '{{ .metadata.labels.aws_region }}'
        path: '{{ .path.path }}'
        repoURL: '{{ .metadata.annotations.git_repo }}'
        targetRevision: '{{ .metadata.annotations.git_revision }}'
      - repoURL: '{{ .metadata.annotations.git_repo | replace "github.com" "github.com:443" }}'
        targetRevision: '{{ .metadata.annotations.git_revision }}'
        ref: values
